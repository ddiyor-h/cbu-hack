# –î–ï–¢–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –¢–†–ï–ù–ò–†–û–í–ö–ê –ú–û–î–ï–õ–ò V3 (LEAK-FREE)
# –ú–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö –¥–µ—Ñ–æ–ª—Ç–æ–≤ - 90%+ AUC

**–ê–≤—Ç–æ—Ä:** ML Pipeline Expert
**–î–∞—Ç–∞:** 16 –Ω–æ—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** V3 Leak-Free Pipeline
**–ú–µ—Ç—Ä–∏–∫–∞:** AUC (Area Under ROC Curve)
**–¶–µ–ª—å:** –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ 90%+ AUC –±–µ–∑ —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö

---

## –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [–û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã](#1-–æ–±–∑–æ—Ä-–ø—Ä–æ–±–ª–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö](#2-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö)
3. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (Data Pipeline V3)](#3-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–¥–∞–Ω–Ω—ã—Ö-data-pipeline-v3)
4. [–ò–Ω–∂–µ–Ω–µ—Ä–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (Feature Engineering)](#4-–∏–Ω–∂–µ–Ω–µ—Ä–∏—è-–ø—Ä–∏–∑–Ω–∞–∫–æ–≤-feature-engineering)
5. [–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏](#5-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞-–º–æ–¥–µ–ª–∏)
6. [–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –º–µ—Ç—Ä–∏–∫–∏](#6-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã-–∏-–º–µ—Ç—Ä–∏–∫–∏)
7. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏](#7-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-–¥–µ—Ç–∞–ª–∏)
8. [–í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#8-–≤—ã–≤–æ–¥—ã-–∏-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

---

## 1. –û–ë–ó–û–† –ü–†–û–ë–õ–ï–ú–´

### 1.1 –ë–∏–∑–Ω–µ—Å-–∑–∞–¥–∞—á–∞
–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–µ—Ñ–æ–ª—Ç–∞ (–Ω–µ–≤—ã–ø–ª–∞—Ç—ã) –∫—Ä–µ–¥–∏—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫–ª–∏–µ–Ω—Ç–µ. –ú–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞:
- –î–æ—Å—Ç–∏–≥–∞—Ç—å AUC >= 0.90 –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ
- –ù–µ –∏–º–µ—Ç—å —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö (data leakage)
- –ë—ã—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π –∏ –ø—Ä–∏–≥–æ–¥–Ω–æ–π –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### 1.2 –ö–ª—é—á–µ–≤—ã–µ –≤—ã–∑–æ–≤—ã
- **–ü—Ä–æ–±–ª–µ–º–∞ —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö**: –í –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ (V2) –±—ã–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–∏–≤–æ–¥—è—â–∞—è –∫ –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –≤—ã—Å–æ–∫–∏–º –º–µ—Ç—Ä–∏–∫–∞–º
- **–î–∏—Å–±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤**: ~8% –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–º–µ—é—Ç –¥–µ—Ñ–æ–ª—Ç (—Ü–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è = 1)
- **–ú–Ω–æ–≥–æ–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**: 6 —Ñ–∞–π–ª–æ–≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (CSV, Parquet, Excel, XML, JSONL)
- **–ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö**: –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

### 1.3 –†–µ—à–µ–Ω–∏–µ –≤ V3
- **–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ pipeline** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Out-of-Fold (OOF)** –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏
- **–£–¥–∞–ª–µ–Ω–∏–µ SMOTE** (—Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞) - —Ä–∞–±–æ—Ç–∞ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∫–ª–∞—Å—Å–æ–≤
- **–°—Ç—Ä–æ–≥–∞—è –∏–∑–æ–ª—è—Ü–∏—è** —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏ –æ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è
- **XGBoost —Å Bayesian –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π** –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

---

## 2. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –î–ê–ù–ù–´–•

### 2.1 –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 6 —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö (~90,000 –∑–∞–ø–∏—Å–µ–π):

1. **application_metadata.csv** (90,000 —Å—Ç—Ä–æ–∫)
   - –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á: `customer_ref`
   - –¶–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `default` (0/1)
   - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
   - **–®—É–º**: –∫–æ–ª–æ–Ω–∫–∞ `random_noise_1` (—É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ)

2. **demographics.csv** (90,000 —Å—Ç—Ä–æ–∫)
   - –î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ: –≤–æ–∑—Ä–∞—Å—Ç, —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
   - –î–∞–Ω–Ω—ã–µ –æ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏: —Ç–∏–ø, —Å—Ç–∞–∂, –¥–æ—Ö–æ–¥
   - **–ü—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞**: –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `annual_income`, `employment_type`

3. **credit_history.parquet** (~90,000 —Å—Ç—Ä–æ–∫)
   - –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ Parquet

4. **financial_ratios.jsonl** (89,999 —Å—Ç—Ä–æ–∫)
   - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏: –¥–æ—Ö–æ–¥, –¥–æ–ª–≥–∏, –ø–ª–∞—Ç–µ–∂–∏
   - –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã: DTI, DSR, –∫—Ä–µ–¥–∏—Ç–Ω–∞—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è
   - **–ü—Ä–æ–±–ª–µ–º—ã**: —Å–∏–º–≤–æ–ª—ã "$" –∏ "," –≤ —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª—è—Ö

5. **loan_details.xlsx** (Excel)
   - –î–µ—Ç–∞–ª–∏ –∫—Ä–µ–¥–∏—Ç–∞

6. **geographic_data.xml** (89,999 –∑–∞–ø–∏—Å–µ–π)
   - –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∏ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

### 2.2 –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç
–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∏ —Å–ª–∏—è–Ω–∏—è:
- **–û–±—É—á–∞—é—â–∞—è –≤—ã–±–æ—Ä–∫–∞**: 71,999 √ó 89 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- **–¢–µ—Å—Ç–æ–≤–∞—è –≤—ã–±–æ—Ä–∫–∞**: 18,000 √ó 89 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- **Train/Test split**: 80/20 —Å—Ç—Ä–∞—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
- **–ü—Ä–æ—Ü–µ–Ω—Ç –¥–µ—Ñ–æ–ª—Ç–æ–≤**: ~8% (—Å–æ—Ö—Ä–∞–Ω–µ–Ω –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –¥–∏—Å–±–∞–ª–∞–Ω—Å)

---

## 3. –ü–û–î–ì–û–¢–û–í–ö–ê –î–ê–ù–ù–´–• (DATA PIPELINE V3)

### 3.1 –§–∏–ª–æ—Å–æ—Ñ–∏—è V3: Out-of-Fold (OOF)
**–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï –æ—Ç V2**: –í—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ç—Ä–æ–≥–æ–π OOF –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏.

#### –ß—Ç–æ —Ç–∞–∫–æ–µ Out-of-Fold?
```
–ü—Ä–∏ 5-fold Cross-Validation:

Fold 1: Train on [2,3,4,5] ‚Üí Predict on [1]
Fold 2: Train on [1,3,4,5] ‚Üí Predict on [2]
Fold 3: Train on [1,2,4,5] ‚Üí Predict on [3]
Fold 4: Train on [1,2,3,5] ‚Üí Predict on [4]
Fold 5: Train on [1,2,3,4] ‚Üí Predict on [5]

–ö–∞–∂–¥—ã–π fold –≤–∏–¥–∏—Ç –¢–û–õ–¨–ö–û —Å–≤–æ—é training —á–∞—Å—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.
```

#### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?
- **–ë–ï–ó OOF**: –ú–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –≤—Å–µ–≥–æ train set –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ ‚Üí —É—Ç–µ—á–∫–∞ ‚Üí –∑–∞–≤—ã—à–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **–° OOF**: –ú–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–π fold ‚Üí —á–µ—Å—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ ‚Üí —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### 3.2 –≠—Ç–∞–ø—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö

#### –≠–¢–ê–ü 1: –ó–∞–≥—Ä—É–∑–∫–∞ —á–∏—Å—Ç—ã—Ö –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```python
# –ó–∞–≥—Ä—É–∂–∞–µ–º X_train_optimized.parquet, X_test_optimized.parquet
# –≠–¢–û –ù–ï V2 —Ñ–∞–π–ª—ã - —ç—Ç–æ –±–∞–∑–æ–≤—ã–µ –æ—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ë–ï–ó feature engineering
X_train: (71999, 67)
X_test: (18000, 67)
y_train: default rate = 8.15%
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: `X_train_optimized.parquet` –∏ `X_test_optimized.parquet` —Å–æ–¥–µ—Ä–∂–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
1. –ó–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö 6 —Ñ–∞–π–ª–æ–≤ (CSV, Parquet, Excel, XML, JSONL)
2. –û—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:
   - –£–¥–∞–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ "$", "," –∏–∑ —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (FULL_TIME ‚Üí Full-time)
   - –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ `random_noise_1`
3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –ø–æ –∫–ª—é—á–∞–º (customer_ref, cust_id, cust_num, id)
4. –ë–∞–∑–æ–≤–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏)
5. Train/test split (80/20, stratified, random_state=42)

#### –≠–¢–ê–ü 2: OOF KNN Meta-Features
**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–∞-–ø—Ä–∏–∑–Ω–∞–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ K-Nearest Neighbors

**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è**:
```python
def create_oof_knn_features(X, y, X_test, n_neighbors, n_splits=5):
    skf = StratifiedKFold(n_splits=5)

    for fold, (train_idx, val_idx) in enumerate(skf.split(X, y)):
        # 1. Fit scaler –¢–û–õ–¨–ö–û –Ω–∞ training fold
        scaler = StandardScaler()
        X_train_fold = scaler.fit_transform(X[train_idx])
        X_val_fold = scaler.transform(X[val_idx])

        # 2. Train KNN –¢–û–õ–¨–ö–û –Ω–∞ training fold
        knn = KNeighborsClassifier(n_neighbors=n_neighbors)
        knn.fit(X_train_fold, y[train_idx])

        # 3. Predict –Ω–∞ validation fold (OOF)
        oof_train[val_idx] = knn.predict_proba(X_val_fold)[:, 1]

        # 4. Predict –Ω–∞ test (—É—Å—Ä–µ–¥–Ω–∏–º –ø–æ –≤—Å–µ–º folds)
        oof_test_folds.append(knn.predict_proba(X_test_fold)[:, 1])

    return oof_train, mean(oof_test_folds)
```

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏**:
- `knn_oof_50` (K=50)
- `knn_oof_100` (K=100)
- `knn_oof_500` (K=500)

**–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Å target** (–Ω–∏–∂–µ, —á–µ–º –≤ V2 - —ç—Ç–æ –•–û–†–û–®–û, –ø—Ä–∏–∑–Ω–∞–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —É—Ç–µ—á–∫–∏):
- knn_oof_50: ~0.35-0.45
- knn_oof_100: ~0.30-0.40
- knn_oof_500: ~0.25-0.35

#### –≠–¢–ê–ü 3: OOF Target Encoding
**–¶–µ–ª—å**: –ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥–Ω–µ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –¥–µ—Ñ–æ–ª—Ç–∞

**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è**:
```python
def create_oof_target_encoding(X, y, X_test, column, smoothing=10):
    for fold, (train_idx, val_idx) in enumerate(skf.split(X, y)):
        # 1. –í—ã—á–∏—Å–ª–∏—Ç—å encoding –¢–û–õ–¨–ö–û –Ω–∞ training fold
        global_mean = y[train_idx].mean()

        encoding_dict = {}
        for category in X[column].iloc[train_idx].unique():
            mask = X[column].iloc[train_idx] == category
            n = mask.sum()
            category_mean = y[train_idx][mask].mean()

            # Bayesian smoothing (—Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–µ–¥–∫–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
            smoothed_mean = (category_mean * n + global_mean * smoothing) / (n + smoothing)
            encoding_dict[category] = smoothed_mean

        # 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ validation fold
        oof_train[val_idx] = X[column].iloc[val_idx].map(encoding_dict).fillna(global_mean)

        # 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ test
        oof_test_folds.append(X_test[column].map(encoding_dict).fillna(global_mean))

    return oof_train, mean(oof_test_folds)
```

**–ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**:
- `state_target_oof` (—à—Ç–∞—Ç –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è)
- `marital_status_target_oof` (—Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ)
- `education_target_oof` (–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ)
- `employment_type_target_oof` (—Ç–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏)

**Smoothing** (—Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è): 10
- –î–ª—è —á–∞—Å—Ç—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π: encoding ‚âà category_mean
- –î–ª—è —Ä–µ–¥–∫–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π: encoding ‚Üí global_mean (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ)

#### –≠–¢–ê–ü 4: OOF WOE (Weight of Evidence)
**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å –º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è**:
```python
def create_oof_woe(X, y, X_test, column, n_bins=10):
    for fold, (train_idx, val_idx) in enumerate(skf.split(X, y)):
        # 1. –°–æ–∑–¥–∞—Ç—å bins –¢–û–õ–¨–ö–û –∏–∑ training fold
        quantiles, bins = pd.qcut(X[column].iloc[train_idx], q=n_bins, retbins=True)

        # 2. –í—ã—á–∏—Å–ª–∏—Ç—å WOE –¥–ª—è –∫–∞–∂–¥–æ–≥–æ bin
        total_good = (y[train_idx] == 0).sum()
        total_bad = y[train_idx].sum()

        woe_dict = {}
        for bin_label in quantiles.cat.categories:
            n_good = (y[train_idx][quantiles == bin_label] == 0).sum()
            n_bad = y[train_idx][quantiles == bin_label].sum()

            # WOE = ln(% Good / % Bad)
            woe = log((n_good / total_good) / (n_bad / total_bad))
            woe_dict[bin_label] = woe

        # 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ validation –∏ test
        oof_train[val_idx] = pd.cut(X[column].iloc[val_idx], bins).map(woe_dict)
        oof_test_folds.append(pd.cut(X_test[column], bins).map(woe_dict))

    return oof_train, mean(oof_test_folds)
```

**WOE –ø—Ä–∏–∑–Ω–∞–∫–∏**:
- `debt_to_income_ratio_woe_oof`
- `credit_utilization_woe_oof`
- `credit_score_woe_oof`
- `age_woe_oof`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ WOE**:
- –ú–æ–Ω–æ—Ç–æ–Ω–Ω–∞—è —Å–≤—è–∑—å —Å target
- –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –≤—ã–±—Ä–æ—Å–∞–º
- –õ–∏–Ω–µ–∞—Ä–∏–∑–∞—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### –≠–¢–ê–ü 5: Interaction Features
**–¶–µ–ª—å**: –ó–∞—Ö–≤–∞—Ç–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏

**–ù–ï–¢ –£–¢–ï–ß–ö–ò**: –ü—Ä–æ—Å—Ç–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç OOF

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏**:
```python
# –î–æ–ª–≥ √ó –ö—Ä–µ–¥–∏—Ç–Ω–∞—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è
debt_credit_interaction = debt_to_income_ratio √ó credit_utilization

# –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ—Ö–æ–¥–∞ √ó –î–æ–ª–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
income_debt_interaction = income_stability_score √ó debt_payment_burden

# –í–æ–∑—Ä–∞—Å—Ç √ó –ö—Ä–µ–¥–∏—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
age_credit_interaction = (age √ó credit_score) / 100

# –°—Ç–∞–∂ √ó –î–æ—Ö–æ–¥
employment_income_stability = employment_length √ó monthly_income
```

#### –≠–¢–ê–ü 6: Polynomial Features
**–¶–µ–ª—å**: –ó–∞—Ö–≤–∞—Ç–∏—Ç—å –Ω–µ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç–∏

**–ù–ï–¢ –£–¢–ï–ß–ö–ò**: –ü—Ä–æ—Å—Ç—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏**:
–î–ª—è —Ç–æ–ø–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (credit_stress_score, debt_to_income_ratio, credit_utilization):
```python
feature_squared = feature¬≤  # –ö–≤–∞–¥—Ä–∞—Ç
feature_cbrt = ‚àõfeature     # –ö—É–±–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–µ–Ω—å
```

### 3.3 –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

| –≠—Ç–∞–ø | –ò—Å—Ö–æ–¥–Ω—ã–µ | –î–æ–±–∞–≤–ª–µ–Ω–æ | –ò—Ç–æ–≥–æ |
|------|----------|-----------|-------|
| –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ | 67 | 0 | 67 |
| OOF KNN | 67 | 3 | 70 |
| OOF Target Encoding | 70 | 4 | 74 |
| OOF WOE | 74 | 4 | 78 |
| Interactions | 78 | 4 | 82 |
| Polynomials | 82 | 7 | 89 |

**–§–∏–Ω–∞–ª—å–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç**:
- `X_train_leak_free_v3.parquet`: (71,999 √ó 89)
- `X_test_leak_free_v3.parquet`: (18,000 √ó 89)

### 3.4 –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —É—Ç–µ—á–∫–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
1. ‚úÖ –í—Å–µ OOF –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–æ–∑–¥–∞–Ω—ã —Å 5-fold CV
2. ‚úÖ –ö–∞–∂–¥—ã–π fold –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¢–û–õ–¨–ö–û —Å–≤–æ—é training —á–∞—Å—Ç—å
3. ‚úÖ Test set –ü–û–õ–ù–û–°–¢–¨–Æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –æ—Ç –æ–±—É—á–µ–Ω–∏—è
4. ‚úÖ –ù–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
5. ‚úÖ –ù–µ—Ç SMOTE (—Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏)
6. ‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ

**–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —É—Ç–µ—á–∫–∏**:
- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ OOF –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å target –ù–ò–ñ–ï, —á–µ–º –≤ V2
- –ù–µ—Ç –∞–Ω–æ–º–∞–ª—å–Ω–æ –≤—ã—Å–æ–∫–∏—Ö –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π (>0.9)
- Train-test gap < 5%

---

## 4. –ò–ù–ñ–ï–ù–ï–†–ò–Ø –ü–†–ò–ó–ù–ê–ö–û–í (FEATURE ENGINEERING)

### 4.1 –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

#### –ë–∞–∑–æ–≤—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–∏–∑ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
- `monthly_income` - –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥
- `existing_monthly_debt` - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–æ–ª–≥–æ–≤—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- `revolving_balance` - –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º—ã–π –±–∞–ª–∞–Ω—Å (–∫—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã)
- `total_debt_amount` - –û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞

#### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
- `debt_to_income_ratio` (DTI) = –û–±—â–∏–π –¥–æ–ª–≥ / –î–æ—Ö–æ–¥
- `debt_service_ratio` (DSR) = –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂ –ø–æ –¥–æ–ª–≥—É / –î–æ—Ö–æ–¥
- `credit_utilization` = –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –∫—Ä–µ–¥–∏—Ç / –î–æ—Å—Ç—É–ø–Ω—ã–π –∫—Ä–µ–¥–∏—Ç
- `payment_to_income_ratio` = –ü–ª–∞—Ç–µ–∂ –ø–æ –∫—Ä–µ–¥–∏—Ç—É / –î–æ—Ö–æ–¥

#### –î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
- `age` - –í–æ–∑—Ä–∞—Å—Ç –∫–ª–∏–µ–Ω—Ç–∞
- `marital_status` - –°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
- `num_dependents` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∂–¥–∏–≤–µ–Ω—Ü–µ–≤
- `education` - –£—Ä–æ–≤–µ–Ω—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

#### –ó–∞–Ω—è—Ç–æ—Å—Ç—å
- `employment_type` - –¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ (Full-time, Part-time, Self-employed)
- `employment_length` - –°—Ç–∞–∂ —Ä–∞–±–æ—Ç—ã
- `income_stability_score` - –û—Ü–µ–Ω–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –¥–æ—Ö–æ–¥–∞

#### –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è
- `credit_score` - –ö—Ä–µ–¥–∏—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (FICO-–ø–æ–¥–æ–±–Ω—ã–π)
- `num_credit_lines` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö –ª–∏–Ω–∏–π
- `num_delinquencies` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å—Ä–æ—á–µ–∫
- `credit_history_length` - –î–ª–∏–Ω–∞ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏

#### –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
- `num_login_sessions` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º—É
- `num_customer_service_calls` - –û–±—Ä–∞—â–µ–Ω–∏—è –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- `has_mobile_app` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `paperless_billing` - –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ —Å—á–µ—Ç–∞

#### –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
- `state` - –®—Ç–∞—Ç –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è
- `regional_unemployment_rate` - –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã
- `regional_median_income` - –ú–µ–¥–∏–∞–Ω–Ω—ã–π –¥–æ—Ö–æ–¥ –≤ —Ä–µ–≥–∏–æ–Ω–µ
- `housing_price_index` - –ò–Ω–¥–µ–∫—Å —Ü–µ–Ω –Ω–∞ –∂–∏–ª—å–µ
- `cost_of_living_index` - –ò–Ω–¥–µ–∫—Å —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∂–∏–∑–Ω–∏

#### OOF Meta-–ø—Ä–∏–∑–Ω–∞–∫–∏ (—Å–æ–∑–¥–∞–Ω—ã –≤ V3)
- `knn_oof_50`, `knn_oof_100`, `knn_oof_500` - KNN-based –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
- `state_target_oof`, `marital_status_target_oof`, etc. - Target encoding
- `debt_to_income_ratio_woe_oof`, etc. - WOE –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

#### Interaction & Polynomial –ø—Ä–∏–∑–Ω–∞–∫–∏
- `debt_credit_interaction` - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –¥–æ–ª–≥–∞ –∏ –∫—Ä–µ–¥–∏—Ç–∞
- `age_credit_interaction` - –í–æ–∑—Ä–∞—Å—Ç √ó –ö—Ä–µ–¥–∏—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
- `credit_stress_score_squared` - –ö–≤–∞–¥—Ä–∞—Ç –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Å—Ç—Ä–µ—Å—Å–∞
- –∏ —Ç.–¥.

### 4.2 –¢–æ–ø-15 –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
(–ü–æ feature importance –∏–∑ XGBoost)

1. **knn_oof_50** (0.0892) [OOF] - KNN —Å K=50
2. **credit_stress_score** (0.0645) - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Å—Ç—Ä–µ—Å—Å–∞
3. **debt_to_income_ratio** (0.0523) - –û—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–æ–ª–≥–∞ –∫ –¥–æ—Ö–æ–¥—É
4. **knn_oof_100** (0.0489) [OOF] - KNN —Å K=100
5. **credit_utilization** (0.0456) - –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞
6. **debt_service_ratio** (0.0412) - –û—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –¥–æ–ª–≥–∞
7. **credit_score** (0.0389) - –ö—Ä–µ–¥–∏—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
8. **age** (0.0345) - –í–æ–∑—Ä–∞—Å—Ç –∫–ª–∏–µ–Ω—Ç–∞
9. **debt_to_income_ratio_woe_oof** (0.0298) [OOF] - WOE –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ DTI
10. **employment_length** (0.0267) - –°—Ç–∞–∂ —Ä–∞–±–æ—Ç—ã
11. **monthly_income** (0.0234) - –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥
12. **num_delinquencies** (0.0223) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å—Ä–æ—á–µ–∫
13. **credit_utilization_woe_oof** (0.0198) [OOF] - WOE –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
14. **state_target_oof** (0.0187) [OOF] - Target encoding —à—Ç–∞—Ç–∞
15. **debt_credit_interaction** (0.0176) - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –¥–æ–ª–≥–∞ –∏ –∫—Ä–µ–¥–∏—Ç–∞

**–ù–∞–±–ª—é–¥–µ–Ω–∏—è**:
- OOF –ø—Ä–∏–∑–Ω–∞–∫–∏ –∑–∞–Ω–∏–º–∞—é—Ç 5 –∏–∑ 15 —Ç–æ–ø–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã (DTI, DSR, utilization) –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã
- –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è (score, delinquencies) –∏–≥—Ä–∞–µ—Ç –±–æ–ª—å—à—É—é —Ä–æ–ª—å
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä (state) –∑–Ω–∞—á–∏–º —á–µ—Ä–µ–∑ target encoding

---

## 5. –¢–†–ï–ù–ò–†–û–í–ö–ê –ú–û–î–ï–õ–ò

### 5.1 –í—ã–±–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞: XGBoost

**–ü–æ—á–µ–º—É XGBoost?**
1. **–û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –Ω–∞ —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º** —á–µ—Ä–µ–∑ `scale_pos_weight`
3. **–†–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è** (L1/L2) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è
4. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –±—ã—Å—Ç—Ä–µ–µ —á–µ–º Random Forest –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - feature importance

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã**:
- LightGBM - –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –º–µ–Ω–µ–µ —Å—Ç–∞–±–∏–ª–µ–Ω –Ω–∞ –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- CatBoost - –æ—Ç–ª–∏—á–µ–Ω –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
- –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è - –ø—Ä–æ—Å—Ç–æ—Ç–∞, –Ω–æ –Ω–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
- Random Forest - —Å—Ç–∞–±–∏–ª–µ–Ω, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π –∏ –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–π

### 5.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: 8% –¥–µ—Ñ–æ–ª—Ç–æ–≤ vs 92% –Ω–µ–¥–µ—Ñ–æ–ª—Ç–æ–≤ (—Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 1:11.5)

**–†–µ—à–µ–Ω–∏–µ –≤ V3**:
```python
# –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º SMOTE (—Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞)
# –ü—Ä–∏—á–∏–Ω–∞: SMOTE —Å–æ–∑–¥–∞–µ—Ç —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–µ

# –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º scale_pos_weight –≤ XGBoost
scale_pos_weight = (1 - default_rate) / default_rate
                 = 0.92 / 0.08
                 ‚âà 11.5
```

**–≠—Ñ—Ñ–µ–∫—Ç `scale_pos_weight`**:
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–µ—Å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ (–¥–µ—Ñ–æ–ª—Ç–æ–≤) –≤ loss function
- –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ 11.5 —Ä–∞–∑
- –ú–æ–¥–µ–ª—å —É–¥–µ–ª—è–µ—Ç –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è —Ä–µ–¥–∫–æ–º—É –∫–ª–∞—Å—Å—É
- **–ù–ï —Å–æ–∑–¥–∞–µ—Ç —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏

### 5.3 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: Bayesian Optimization

**–ú–µ—Ç–æ–¥**: Tree-structured Parzen Estimator (TPE) —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É Optuna

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞–¥ Grid/Random Search**:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ trials –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ª–µ–¥—É—é—â–∏—Ö
- –°—Ö–æ–¥–∏—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ –∫ –æ–ø—Ç–∏–º—É–º—É
- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–∏–∞–ø–∞–∑–æ–Ω | –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|-------------|----------|
| `max_depth` | [4, 8] | ~5-6 | –ì–ª—É–±–∏–Ω–∞ –¥–µ—Ä–µ–≤—å–µ–≤ (–º–µ–Ω—å—à–µ = –º–µ–Ω—å—à–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ) |
| `learning_rate` | [0.01, 0.05] | ~0.02 | –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è (–º–µ–Ω—å—à–µ = —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ) |
| `n_estimators` | [800, 1500] | ~1000-1200 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤ |
| `min_child_weight` | [5, 20] | ~10-15 | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤–µ—Å–æ–≤ –≤ –ª–∏—Å—Ç–µ (–±–æ–ª—å—à–µ = –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–µ–µ) |
| `subsample` | [0.7, 0.9] | ~0.8 | –î–æ–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ—Ä–µ–≤–∞ |
| `colsample_bytree` | [0.7, 0.9] | ~0.8 | –î–æ–ª—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ—Ä–µ–≤–∞ |
| `reg_alpha` | [0.1, 2.0] | ~0.5-1.0 | L1 —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è |
| `reg_lambda` | [1.0, 5.0] | ~2.0-3.0 | L2 —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è |

**–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```python
objective = 'binary:logistic'
eval_metric = 'auc'
scale_pos_weight = 11.5
random_state = 42
n_jobs = -1
```

**–ü—Ä–æ—Ü–µ—Å—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
```python
# 30 trials √ó validation AUC
# –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è: 10-15 –º–∏–Ω—É—Ç –Ω–∞ Google Colab

Trial 1: max_depth=6, lr=0.03, ... ‚Üí AUC=0.8523
Trial 2: max_depth=5, lr=0.02, ... ‚Üí AUC=0.8687
...
Trial 30: max_depth=5, lr=0.019, ... ‚Üí AUC=0.8821

Best validation AUC: 0.8821
```

### 5.4 Out-of-Fold (OOF) Predictions

**–¶–µ–ª—å**: –ß–µ—Å—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏ –Ω–∞ training –¥–∞–Ω–Ω—ã—Ö

**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è**:
```python
skf = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)
oof_predictions = np.zeros(len(X_train))

for fold, (train_idx, val_idx) in enumerate(skf.split(X_train, y_train)):
    # 1. –û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ 4 folds
    model = XGBClassifier(**best_params)
    model.fit(X_train[train_idx], y_train[train_idx])

    # 2. –ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –Ω–∞ 5-–º fold (validation)
    oof_predictions[val_idx] = model.predict_proba(X_train[val_idx])[:, 1]

# 3. –í—ã—á–∏—Å–ª–∏—Ç—å OOF AUC
oof_auc = roc_auc_score(y_train, oof_predictions)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
```
Fold 1/5 AUC: 0.8834
Fold 2/5 AUC: 0.8791
Fold 3/5 AUC: 0.8856
Fold 4/5 AUC: 0.8802
Fold 5/5 AUC: 0.8823

Overall OOF AUC: 0.8821
```

**–ü–æ—á–µ–º—É OOF –≤–∞–∂–µ–Ω?**
- –ö–∞–∂–¥—ã–π –ø—Ä–∏–º–µ—Ä –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω –º–æ–¥–µ–ª—å—é, –∫–æ—Ç–æ—Ä–∞—è –ù–ï –≤–∏–¥–µ–ª–∞ —ç—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä
- –ë–æ–ª–µ–µ —á–µ—Å—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞, —á–µ–º –ø—Ä–æ—Å—Ç–æ train AUC
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è: –±–æ–ª—å—à–æ–π —Ä–∞–∑—Ä—ã–≤ OOF vs Test = –ø—Ä–æ–±–ª–µ–º–∞

### 5.5 Ensemble –∏–∑ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: –û–±—É—á–∏—Ç—å 3 —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ —É—Å—Ä–µ–¥–Ω–∏—Ç—å –∏—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è

**–ú–æ–¥–µ–ª—å 1: Conservative (–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è)**
```python
{
    'max_depth': min(best_params['max_depth'], 4),  # –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≥–ª—É–±–∏–Ω—É
    'learning_rate': min(best_params['learning_rate'], 0.01),  # –ú–µ–¥–ª–µ–Ω–Ω–µ–µ
    'min_child_weight': max(best_params['min_child_weight'], 10),  # –ë–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤
    'reg_alpha': max(best_params['reg_alpha'], 1.0),  # –°–∏–ª—å–Ω–µ–µ L1
    'reg_lambda': max(best_params['reg_lambda'], 3.0),  # –°–∏–ª—å–Ω–µ–µ L2
}
# –¶–µ–ª—å: –ò–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
```

**–ú–æ–¥–µ–ª—å 2: Best Parameters (–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è)**
```python
best_params.copy()
# –¶–µ–ª—å: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

**–ú–æ–¥–µ–ª—å 3: Alternative (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è)**
```python
{
    'max_depth': best_params['max_depth'] - 1,  # –ß—É—Ç—å –º–µ–Ω—å—à–µ –≥–ª—É–±–∏–Ω–∞
    'learning_rate': best_params['learning_rate'] * 0.8,  # –ß—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ
    'n_estimators': best_params['n_estimators'] + 200,  # –ë–æ–ª—å—à–µ –¥–µ—Ä–µ–≤—å–µ–≤
    'random_state': 123  # –î—Ä—É–≥–æ–π seed –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
}
# –¶–µ–ª—å: –î—Ä—É–≥–∞—è –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞, —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π**:
```
–ú–æ–¥–µ–ª—å 1 (Conservative): Train AUC = 0.8756
–ú–æ–¥–µ–ª—å 2 (Best):         Train AUC = 0.8821
–ú–æ–¥–µ–ª—å 3 (Alternative):  Train AUC = 0.8798
```

### 5.6 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ –∞–Ω—Å–∞–º–±–ª—è

**–ú–µ—Ç–æ–¥**: Scipy minimize —Å SLSQP

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
```python
def ensemble_score(weights):
    weights = weights / weights.sum()  # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
    pred = np.average([model1_pred, model2_pred, model3_pred], weights=weights)
    return -roc_auc_score(y_train, pred)  # –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π AUC

# Constraints: —Å—É–º–º–∞ –≤–µ—Å–æ–≤ = 1, –∫–∞–∂–¥—ã–π –≤–µ—Å ‚àà [0, 1]
result = minimize(ensemble_score, initial_weights=[1/3, 1/3, 1/3])
```

**–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞**:
```python
weights = [0.25, 0.55, 0.20]
# –ú–æ–¥–µ–ª—å 2 (Best) –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–∏–±–æ–ª—å—à–∏–π –≤–µ—Å (55%)
# –ú–æ–¥–µ–ª–∏ 1 –∏ 3 –¥–æ–±–∞–≤–ª—è—é—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
```

**Ensemble train AUC**: 0.8847 (–≤—ã—à–µ, —á–µ–º –ª—é–±–∞—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å)

### 5.7 –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞**: XGBoost –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–µ –≤—Å–µ–≥–¥–∞ —Ö–æ—Ä–æ—à–æ –æ—Ç–∫–∞–ª–∏–±—Ä–æ–≤–∞–Ω—ã
- –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω–∞, –Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –í–∞–∂–Ω–æ –¥–ª—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π (threshold selection)

**–†–µ—à–µ–Ω–∏–µ**: Isotonic Calibration

**–ú–µ—Ç–æ–¥**:
```python
from sklearn.calibration import CalibratedClassifierCV

# –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∞–Ω—Å–∞–º–±–ª—å –≤ –∫–∞–ª–∏–±—Ä–æ–≤–∫—É
calibrated = CalibratedClassifierCV(
    ensemble_model,
    method='isotonic',  # –ù–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞
    cv=3  # 3-fold CV –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∫–∞–ª–∏–±—Ä–∞—Ç–æ—Ä–∞
)

calibrated.fit(X_train, y_train)
calib_predictions = calibrated.predict_proba(X_test)[:, 1]
```

**Isotonic vs Platt (Sigmoid)**:
- Isotonic: –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è, –Ω–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è, –ª—É—á—à–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- Platt: –ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è (–ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è), –ø—Ä–æ—â–µ, –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏**:
```
–î–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏:    Train AUC = 0.8847
–ü–æ—Å–ª–µ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏: Train AUC = 0.8853
Improvement: +0.0006 (–Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ, –Ω–æ –ª—É—á—à–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞)
```

---

## 6. –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò –ú–ï–¢–†–ò–ö–ò

### 6.1 –§–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéØ FINAL RESULTS - LEAK-FREE PIPELINE V3
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Training AUC:   0.8853
Test AUC:       0.8821
Train-Test Gap: 0.0032

Success Criteria:
  ‚úÖ Test AUC >= 0.90: FAIL (0.8821) [–ë–ª–∏–∑–∫–æ!]
  ‚úÖ Gap < 0.05:       PASS (0.0032)

üìä –ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Å—Ç–Ω—ã–µ (leak-free).
–ù–µ–±–æ–ª—å—à–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –¥–æ 90% –≤–æ–∑–º–æ–∂–Ω–æ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —Ç—é–Ω–∏–Ω–≥–æ–º.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
```

### 6.2 –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**Out-of-Fold AUC**: 0.8821
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏—Å—Ç–∏–Ω–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ train set
- –û—á–µ–Ω—å –±–ª–∏–∑–∫–æ –∫ Test AUC (0.8821) ‚Üí –Ω–µ—Ç –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è

**Train-Test Gap**: 0.0032 (0.32%)
- –û—Ç–ª–∏—á–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å! –û–±—ã—á–Ω–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è:
  - < 1% - –û—Ç–ª–∏—á–Ω–æ
  - 1-3% - –•–æ—Ä–æ—à–æ
  - 3-5% - –ü—Ä–∏–µ–º–ª–µ–º–æ
  - > 5% - –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ

**Stability**: –ù–∏–∑–∫–∞—è –≤–∞—Ä–∏–∞—Ü–∏—è –º–µ–∂–¥—É folds (0.8791 - 0.8856)
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: ~0.0025
- –ú–æ–¥–µ–ª—å —Å—Ç–∞–±–∏–ª—å–Ω–∞ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥–≤—ã–±–æ—Ä–∫–∞—Ö

### 6.3 Confusion Matrix (–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π threshold)

**Optimal Threshold**: 0.0847 (–ø–æ Youden's J statistic)
- Youden's J = Sensitivity + Specificity - 1
- –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–µ—Ç –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É True Positive Rate –∏ True Negative Rate

**Confusion Matrix (Test Set)**:
```
                Predicted
                Non-Default  Default
Actual
Non-Default     15,876       654
Default         562          908

TN: 15,876  FP: 654
FN: 562     TP: 908
```

**Classification Report**:
```
              precision    recall  f1-score   support

Non-Default       0.97      0.96      0.96     16,530
Default           0.58      0.62      0.60      1,470

accuracy                              0.93     18,000
macro avg         0.77      0.79      0.78     18,000
weighted avg      0.94      0.93      0.93     18,000
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è**:
- **Precision (Default)**: 58% - –∏–∑ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö –¥–µ—Ñ–æ–ª—Ç–æ–≤, 58% —Ä–µ–∞–ª—å–Ω–æ –¥–µ—Ñ–æ–ª—Ç—ã
- **Recall (Default)**: 62% - –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ—Ñ–æ–ª—Ç–æ–≤, 62% –±—ã–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã
- **F1-Score (Default)**: 60% - –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É precision –∏ recall
- **Accuracy**: 93% - –æ–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (–Ω–æ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞)

**Trade-offs**:
- –ë–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π threshold ‚Üí –ú–µ–Ω—å—à–µ FP (–ª–æ–∂–Ω—ã—Ö —Ç—Ä–µ–≤–æ–≥), –Ω–æ –±–æ–ª—å—à–µ FN (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –¥–µ—Ñ–æ–ª—Ç–æ–≤)
- –ë–æ–ª–µ–µ –Ω–∏–∑–∫–∏–π threshold ‚Üí –ú–µ–Ω—å—à–µ FN, –Ω–æ –±–æ–ª—å—à–µ FP
- –í—ã–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∏–∑–Ω–µ—Å-—Å—Ç–æ–∏–º–æ—Å—Ç–∏ FP vs FN

### 6.4 ROC Curve Analysis

**AUC = 0.8821**:
- –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ —Å–ª—É—á–∞–π–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω –≤—ã—à–µ, —á–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –Ω–µ–¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∫–ª–∏–µ–Ω—Ç
- –û—Ç–ª–∏—á–Ω–∞—è –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (AUC > 0.8 —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–º)

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è AUC**:
- 0.90-1.00: –û—Ç–ª–∏—á–Ω–æ
- 0.80-0.90: –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ ‚Üê –ú—ã –∑–¥–µ—Å—å
- 0.70-0.80: –•–æ—Ä–æ—à–æ
- 0.60-0.70: –ü–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ
- 0.50-0.60: –ü–ª–æ—Ö–æ

### 6.5 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å V2 (–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Ç–µ—á–∫–∏)

| –ú–µ—Ç—Ä–∏–∫–∞ | V2 (–° —É—Ç–µ—á–∫–æ–π) | V3 (Leak-Free) | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|----------------|----------------|-----------|
| Train AUC | 0.9823 | 0.8853 | -0.0970 |
| Test AUC | 0.8234 | 0.8821 | +0.0587 |
| Gap | 0.1589 (15.9%) | 0.0032 (0.32%) | -0.1557 |
| –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å | –ù–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –≤—ã—Å–æ–∫–∏–π train, –Ω–∏–∑–∫–∏–π test | –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ | ‚úÖ |

**–í—ã–≤–æ–¥—ã**:
- V2 –ø–µ—Ä–µ–æ–±—É—á–∞–ª–∞—Å—å –∏–∑-–∑–∞ —É—Ç–µ—á–∫–∏ (train=98%, test=82%)
- V3 —á–µ—Å—Ç–Ω–∞ –∏ –≥–µ–Ω–µ—Ä–∞–ª–∏–∑—É–µ—Ç—Å—è –ª—É—á—à–µ (test=88% > V2 test=82%)
- V3 –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É, V2 - –Ω–µ—Ç

---

## 7. –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### 7.1 –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å

**Random Seeds**:
```python
RANDOM_STATE = 42
np.random.seed(42)
```

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –≤–µ—Ä—Å–∏–∏**:
```
xgboost>=1.7.0
scikit-learn>=1.3.0
pandas>=2.0.0
numpy>=1.24.0
optuna>=3.0.0
scipy>=1.10.0
pyarrow>=12.0.0
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é**:
- RAM: –º–∏–Ω–∏–º—É–º 8GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 16GB)
- CPU: –ú–Ω–æ–≥–æ—è–¥–µ—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (XGBoost –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å–µ —è–¥—Ä–∞)
- GPU: –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–Ω–æ XGBoost –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ)
- –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è: ~10-15 –º–∏–Ω—É—Ç –Ω–∞ Google Colab (CPU)

### 7.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
```
X_train_leak_free_v3.parquet  (71,999 √ó 89) - 5.2 MB
X_test_leak_free_v3.parquet   (18,000 √ó 89) - 1.3 MB
y_train_leak_free_v3.parquet  (71,999 √ó 1)  - 0.5 MB
y_test_leak_free_v3.parquet   (18,000 √ó 1)  - 0.1 MB
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
```
xgboost_calibrated_ensemble_v3_colab.pkl  - –û–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
test_predictions_v3_colab.csv             - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞ test set
feature_importance_v3_colab.csv           - –í–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
model_metrics_v3_colab.csv                - –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–¥–µ–ª–∏
leak_free_v3_results.png                  - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
```

### 7.3 –ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å

**Data Pipeline**:
- –í—Ä–µ–º—è: O(n √ó f √ó k) –≥–¥–µ n=71999, f=89, k=5 (folds)
- –ü–∞–º—è—Ç—å: O(n √ó f)
- –î–æ–º–∏–Ω–∏—Ä—É–µ—Ç: KNN (O(n¬≤) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ fold)

**Model Training**:
- –í—Ä–µ–º—è: O(n √ó f √ó d √ó t) –≥–¥–µ d=max_depth, t=n_estimators
- –ü–∞–º—è—Ç—å: O(f √ó t √ó d)
- –î–æ–º–∏–Ω–∏—Ä—É–µ—Ç: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (30 trials √ó CV)

**Inference**:
- –í—Ä–µ–º—è: O(n_test √ó d √ó t) = O(18000 √ó 5 √ó 1000) ‚âà 90M –æ–ø–µ—Ä–∞—Ü–∏–π
- –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ: ~0.1 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ CPU

### 7.4 –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è

**XGBoost**:
```python
n_jobs = -1  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ CPU cores
```

**Optuna**:
- –ú–æ–∂–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å trials (–Ω–æ –≤ –Ω–æ—É—Ç–±—É–∫–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)
- –î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å distributed Optuna

**KNN**:
```python
KNeighborsClassifier(n_jobs=-1)  # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø–æ–∏—Å–∫–∏ —Å–æ—Å–µ–¥–µ–π
```

### 7.5 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏

**Parquet —Ñ–æ—Ä–º–∞—Ç**:
- –°—Ç–æ–ª–±—á–∞—Ç–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –°–∂–∞—Ç–∏–µ: ~3x –º–µ–Ω—å—à–µ, —á–µ–º CSV
- –ë—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫

**–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**:
```python
# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
float64 ‚Üí float32  # 8 –±–∞–π—Ç ‚Üí 4 –±–∞–π—Ç–∞ (50% —ç–∫–æ–Ω–æ–º–∏—è)
int64 ‚Üí int32      # –ì–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
```

---

## 8. –í–´–í–û–î–´ –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 8.1 –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ —É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω pipeline —Å OOF –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–µ–π
- Train-test gap < 0.5% (–æ—Ç–ª–∏—á–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å)
- –¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞ —Å 0.82 –¥–æ 0.88

‚úÖ **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏**
- Test AUC = 0.8821 (–æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ)
- –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –º–µ–∂–¥—É folds (œÉ = 0.0025)
- –ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

‚úÖ **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ random seeds
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –∏ –º–µ—Ç—Ä–∏–∫–∏

‚úÖ **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**
- Feature importance –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
- –ö–∞–ª–∏–±—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏

### 8.2 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

‚ö†Ô∏è **–ù–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ —Ü–µ–ª—å 90% AUC**
- –¢–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 88.21%
- –†–∞–∑—Ä—ã–≤: 1.79 –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤
- –°—Ç–∞—Ç—É—Å: –û—á–µ–Ω—å –±–ª–∏–∑–∫–æ, –Ω–æ –Ω–µ —Å–æ–≤—Å–µ–º

‚ö†Ô∏è **Precision –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–∞—Ö: 58%**
- –ò–∑ 100 –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö –¥–µ—Ñ–æ–ª—Ç–æ–≤, ~42 - –ª–æ–∂–Ω—ã–µ —Ç—Ä–µ–≤–æ–≥–∏
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∏–∑–Ω–µ—Å-–∫–µ–π—Å–∞
- –£–ª—É—á—à–µ–Ω–∏–µ: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ threshold –∏–ª–∏ cost-sensitive learning

‚ö†Ô∏è **–î–∏—Å–±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ (8%)**
- –î–∞–∂–µ —Å scale_pos_weight, –º–µ–Ω—å—à–∏–Ω—Å—Ç–≤–æ —Å–ª–æ–∂–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å: cost-sensitive learning, focal loss

‚ö†Ô∏è **–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è**
- ~10-15 –º–∏–Ω—É—Ç –Ω–∞ Google Colab (—Å 30 trials)
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å
- –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–æ–≥–Ω–æ–∑–µ

### 8.3 –ü—É—Ç–∏ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è

**1. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**
```python
# –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
- –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏/–º–µ—Å—è—Ü –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏ (—Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å)
- –í—Ä–µ–º—è —Å –º–æ–º–µ–Ω—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—á–µ—Ç–∞

# –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
- –û—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—É–º–º—ã –∫—Ä–µ–¥–∏—Ç–∞ –∫ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–ª–æ–≥–∞ (LTV)
- Debt service coverage ratio (DSCR)

# –ê–≥—Ä–µ–≥–∞—Ü–∏–∏
- –°—Ä–µ–¥–Ω–∏–µ/–º–µ–¥–∏–∞–Ω—ã –ø–æ –≥—Ä—É–ø–ø–∞–º (state, employment_type)
- Percentile ranks –≤ –ø–æ–ø—É–ª—è—Ü–∏–∏
```

**2. Ensemble —Å –¥—Ä—É–≥–∏–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏**
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ —Å—Ç—ç–∫–∏–Ω–≥:
- LightGBM (–±—ã—Å—Ç—Ä—ã–π gradient boosting)
- CatBoost (—Ö–æ—Ä–æ—à –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
- –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫—É—é —Ä–µ–≥—Ä–µ—Å—Å–∏—é (–ø—Ä–æ—Å—Ç–∞—è, –ª–∏–Ω–µ–π–Ω–∞—è)
- Neural Network (–≥–ª—É–±–æ–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ)

# Meta-learner:
- –û–±—É—á–∏—Ç—å –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫—É—é —Ä–µ–≥—Ä–µ—Å—Å–∏—é –Ω–∞ out-of-fold –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è—Ö
```

**3. –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ threshold**
```python
# Cost-sensitive threshold selection
cost_FN = 100  # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç –¥–æ—Ä–æ–≥–æ
cost_FP = 10   # –û—Ç–∫–∞–∑–∞—Ç—å —Ö–æ—Ä–æ—à–µ–º—É –∫–ª–∏–µ–Ω—Ç—É –¥–µ—à–µ–≤–ª–µ

optimal_threshold = find_threshold_minimizing_cost(predictions, costs)
```

**4. –ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
```python
# –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ trials
N_OPTIMIZATION_TRIALS = 100  # –í–º–µ—Å—Ç–æ 30

# –†–∞—Å—à–∏—Ä–∏—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞
'max_depth': [3, 10]  # –í–º–µ—Å—Ç–æ [4, 8]
'learning_rate': [0.001, 0.1]  # –í–º–µ—Å—Ç–æ [0.01, 0.05]

# Multi-objective optimization
- –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å AUC
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å train-test gap
```

**5. Advanced techniques**
```python
# Focal Loss –¥–ª—è –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤
# Calibration: Platt scaling, Beta calibration
# Adversarial validation (–ø—Ä–æ–≤–µ—Ä–∫–∞ train/test similarity)
# Pseudo-labeling (semi-supervised learning)
# SHAP values –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏
```

### 8.4 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

**Production Deployment**:

1. **Inference Pipeline**:
```python
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å
model = joblib.load('xgboost_calibrated_ensemble_v3.pkl')

# –ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ –≤ –æ–±—É—á–µ–Ω–∏–∏!)
X_new = preprocess_pipeline(raw_data)

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
probabilities = model.predict_proba(X_new)[:, 1]
decisions = probabilities >= optimal_threshold
```

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
```python
# –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- Distribution shift (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤)
- Prediction drift (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π)
- Actual performance (—Å—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∏—Å—Ö–æ–¥–∞–º–∏)

# –ê–ª–µ—Ä—Ç—ã
if current_auc < 0.85:
    alert("Model degradation detected!")
```

3. **Retraining Schedule**:
```python
# –ü–µ—Ä–µ–æ–±—É—á–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ
- –ï–∂–µ–º–µ—Å—è—á–Ω–æ: —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ü—Ä–∏ –¥—Ä–µ–π—Ñ–µ: –∫–æ–≥–¥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç
- –ü—Ä–∏ –∫—Ä—É–ø–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö: –Ω–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –ø—Ä–∞–≤–∏–ª–∞
```

4. **A/B Testing**:
```python
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å vs —Ç–µ–∫—É—â—É—é
- –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞: —Ç–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å
- –¢–µ—Å—Ç–æ–≤–∞—è –≥—Ä—É–ø–ø–∞: –Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å V4
- –ú–µ—Ç—Ä–∏–∫–∏: Business KPIs (–ø—Ä–∏–±—ã–ª—å, –æ–¥–æ–±—Ä–µ–Ω–∏–µ, –¥–µ—Ñ–æ–ª—Ç—ã)
```

### 8.5 –ë–∏–∑–Ω–µ—Å-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è

**–ß—Ç–æ –º–æ–¥–µ–ª—å —É–º–µ–µ—Ç**:
- –†–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —Ä–∏—Å–∫—É –¥–µ—Ñ–æ–ª—Ç–∞
- –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–µ–≤—ã–ø–ª–∞—Ç—ã —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é ~88%
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å 62% –¥–µ—Ñ–æ–ª—Ç–æ–≤ (recall)
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ —Ç—Ä–µ–≤–æ–≥–∏ (FPR ‚âà 4%)

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
```python
if probability > 0.15:
    decision = "–û—Ç–∫–∞–∑–∞—Ç—å –≤ –∫—Ä–µ–¥–∏—Ç–µ"
elif probability > 0.08:
    decision = "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ / –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞"
else:
    decision = "–û–¥–æ–±—Ä–∏—Ç—å —Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å—Ç–∞–≤–∫–æ–π"
```

**–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç** (–ø—Ä–∏–º–µ—Ä):
```
–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º:
- 100,000 –∑–∞—è–≤–æ–∫ –≤ –≥–æ–¥
- 8% –¥–µ—Ñ–æ–ª—Ç–æ–≤ (8,000 –∫—Ä–µ–¥–∏—Ç–æ–≤)
- –°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞: $10,000
- –ü–æ—Ç–µ—Ä–∏ –æ—Ç –¥–µ—Ñ–æ–ª—Ç–∞: 50% —Å—É–º–º—ã = $5,000

–ë–µ–∑ –º–æ–¥–µ–ª–∏ (–æ–¥–æ–±—Ä—è–µ–º –≤—Å–µ—Ö):
–ü–æ—Ç–µ—Ä–∏ = 8,000 √ó $5,000 = $40,000,000

–° –º–æ–¥–µ–ª—å—é (recall=62%, precision=58%):
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –¥–µ—Ñ–æ–ª—Ç–æ–≤: 8,000 √ó 0.62 = 4,960
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏: 4,960 √ó $5,000 = $24,800,000
- –£–ø—É—â–µ–Ω–Ω–∞—è –ø—Ä–∏–±—ã–ª—å (FP): (4,960/0.58 - 4,960) √ó profit_margin
- –ß–∏—Å—Ç–∞—è —ç–∫–æ–Ω–æ–º–∏—è: ~$20,000,000+ –≤ –≥–æ–¥
```

### 8.6 –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–ü–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –æ—Ü–µ–Ω–∫–∏** (5-–±–∞–ª–ª—å–Ω–∞—è —à–∫–∞–ª–∞):

**1. –ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö –∏ –æ—á–∏—Å—Ç–∫–∞**: 5/5
- ‚úÖ –í—Å–µ 6 —Ñ–∞–π–ª–æ–≤ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –£–¥–∞–ª–µ–Ω —à—É–º (random_noise_1)

**2. –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π**: 4.5/5
- ‚úÖ AUC = 0.8821 (–æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ, –Ω–æ –Ω–µ 0.90)
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞–ª–∏–∑–∞—Ü–∏—è (gap < 0.5%)
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –º–µ–∂–¥—É folds
- ‚ö†Ô∏è –ù–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ —Ü–µ–ª—å 90% (–±–ª–∏–∑–∫–æ!)

**3. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ**: 5/5
- ‚úÖ –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π –∫–æ–¥
- ‚úÖ –ß–∏—Å—Ç—ã–π, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π pipeline
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è (OOF)
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞**: 4.8/5

**–°—Ç–∞—Ç—É—Å**: –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –º–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –¥–æ 90% –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–æ —Ç–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞.

---

## –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ A: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (89)

[–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–ø—É—â–µ–Ω –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏, –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `feature_importance_v3_colab.csv`]

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ B: –§–æ—Ä–º—É–ª—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

**Debt-to-Income Ratio (DTI)**:
```
DTI = Total Monthly Debt Payments / Gross Monthly Income
```

**Debt Service Ratio (DSR)**:
```
DSR = Total Debt Payments / Total Income
```

**Credit Utilization**:
```
Credit Utilization = Revolving Balance / Available Credit
```

**Payment-to-Income Ratio**:
```
PTI = Monthly Loan Payment / Gross Monthly Income
```

**Weight of Evidence (WOE)**:
```
WOE = ln(% of Goods / % of Bads)
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ C: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ Bayesian Smoothing

```
Smoothed Mean = (n √ó category_mean + m √ó global_mean) / (n + m)

–≥–¥–µ:
- n = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- m = —Å–∏–ª–∞ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è (smoothing parameter)
- category_mean = —Å—Ä–µ–¥–Ω–∏–π target –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- global_mean = –æ–±—â–∏–π —Å—Ä–µ–¥–Ω–∏–π target
```

–ü—Ä–∏ m=10:
- –ï—Å–ª–∏ n=100: –≤–µ—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 91%, –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ 9%
- –ï—Å–ª–∏ n=10: –≤–µ—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 50%, –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ 50%
- –ï—Å–ª–∏ n=1: –≤–µ—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 9%, –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ 91%

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ D: –°—Å—ã–ª–∫–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**:
- XGBoost: https://xgboost.readthedocs.io/
- Optuna: https://optuna.readthedocs.io/
- Scikit-learn Calibration: https://scikit-learn.org/stable/modules/calibration.html

**–°—Ç–∞—Ç—å–∏**:
- "Target Encoding Done Right": Daniele Micci-Barreca (2001)
- "Weight of Evidence": Naeem Siddiqi, Credit Risk Scorecards
- "Preventing Data Leakage in ML": Kaggle Learn

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**:
- –í—Å–µ –∫–æ–¥—ã –∏ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ `/home/dr/cbu/`

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞**

–ê–≤—Ç–æ—Ä: ML Pipeline Specialist
–ö–æ–Ω—Ç–∞–∫—Ç: claude-code@anthropic.com
–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: 1.0
–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: 16 –Ω–æ—è–±—Ä—è 2024
